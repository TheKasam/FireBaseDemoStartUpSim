<!DOCTYPE html>
<html lang="en">

<head>
    <title>StarUp Simulation 2018</title>



    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="./index.css">
    <script src="js/typed.js"></script>

<body>

    <!-- create navBar -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-left" href="#page-content">
                    <img alt="Brand" src="img/Event.png" width="100">
                </a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a class="page_scroll" id="page-scroll" href="#home">Home</a></li>
                    <li><a class="page_scroll" id="page-scroll" href="#about">About</a></li>
                    <li><a class="page_scroll" id="page-scroll" href="#FAQQ">FAQ</a></li>
                    <li><a class="page_scroll" id="page-scroll" href="#email">Contact Us</a></li>
                    <li><a class="page_scroll" id="page-scroll" href="#schedulee">Schedule</a></li>
                    <li class="navbar-right"><a class="page_scroll " id="page-scroll" href="#SignUp">Sign Up</a></li>

                </ul>
            </div>
        </div>
    </nav>

    <div class="example">
        <h1 class="one">1Hello world</h1>
        <h1 class="two">2Hello world</h1>
        <h1 class="three">3Hello world</h1>
    </div>

    <form>
        <div class="form-group">
          <label for="exampleInputEmail1">Email address</label>
          <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Enter email">
          <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
        </div>
        <div class="form-group">
          <label for="exampleInputPassword1">Password</label>
          <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
        </div>
        <div class="form-check">
          <input type="checkbox" class="form-check-input" id="exampleCheck1">
          <label class="form-check-label" for="exampleCheck1">Check me out</label>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>

</body>

</html>

<script>

    function handleSignIn(){

        var email = document.getElementById('email').value;
        var password = document.getElementById('password').value;
        var isError = false;

        if (email.length <1) {
          document.getElementById("e12").style.display = "initial";
          document.getElementById('e12').innerHTML = "Please enter an email address.";
          isError = true;
        } else {
          document.getElementById("e12").style.display = "none";
        }

        if (password.length <1) {
          document.getElementById("e22").style.display = "initial";
          document.getElementById('e22').innerHTML = "Please enter an password.";
          isError = true;
        } else {
          document.getElementById("e22").style.display = "none";
        }
        if (isError){
           return;
        }

        firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        if (errorCode === 'auth/wrong-password') {
          document.getElementById("e22").style.display = "initial";
          document.getElementById('e22').innerHTML = "Wrong password."
          isError = true;
        } else {
          document.getElementById("e22").style.display = "none";
        }

        if(errorCode ==='auth/user-not-found') {
            document.getElementById("e12").style.display = "initial";
            document.getElementById('e12').innerHTML = "User not found.";
            isError = true;
        } else {
            document.getElementById("e12").style.display = "none";
        }

        if (errorCode && errorCode !='auth/user-not-found') {
          firebase.auth().fetchProvidersForEmail(email.trim()).then(function(providers) {
          if (providers[0] == "google.com"){
              document.getElementById("e22").style.display = "initial";
              document.getElementById('e22').innerHTML = "Please continue with google.";
              isError = true;
          } else {
          document.getElementById("e22").style.display = "initial";
          document.getElementById('e22').innerHTML = errorCode;
          isError = true;
          }


        });
        } else {
          document.getElementById("e22").style.display = "none";
        }


        if (isError){
            return;
        }



        }).then(() => {
                firebase.auth().onAuthStateChanged(function(user) {

                if (user){
                var emailVerified = user.emailVerified;
                    if (emailVerified == false){
                        document.location.href = 'emailVerification.html';
                    } else {
                        document.location.href = 'add.html';
                    }


                } else {
                    console.log("error");
                }


                 });
           });


    }



    function initApp() {
       // Listening for auth state changes.
       firebase.auth().onAuthStateChanged(function(user) {

         if (user) {
             var emailVerified = user.emailVerified;
             if (emailVerified == false){
                 document.location.href = 'emailVerification.html';

            }

         } else {
          //document.getElementById('initial').textContent = 'not signed in';

         }

          // [END_EXCLUDE]
       });
       // [END authstatelistener]



       document.getElementById('sign-in-btn').addEventListener('click', handleSignIn, false);
       document.getElementById('google-sign-in').addEventListener('click', google, false);


     }
     window.onload = function() {
       initApp();
     };


    function google(){
        var provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('https://www.googleapis.com/auth/userinfo.email');
        provider.addScope('https://www.googleapis.com/auth/userinfo.profile');
        firebase.auth().signInWithPopup(provider).then(function(result) {
        // This gives you a Google Access Token. You can use it to access the Google API.
        var token = result.credential.accessToken;
        // The signed-in user info.
        var user = result.user;
        //alert(user.displayName);

        var email = user.email;
        var name = user.displayName;
        var uid = user.uid;

        return firebase.database().ref().child('users').child(uid).update({

          email:email,
          name:name
        }).then(() => {
               document.location.href = 'add.html';
           });


    // ...
    }).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // The email of the user's account used.
        var email = error.email;
        // The firebase.auth.AuthCredential type that was used.
        var credential = error.credential;
        // ...
    });

    }
    </script>

<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCfRx0VipA1hdXHrXvDEktgjH9k9LrguCM",
    authDomain: "startupsimulation-2146b.firebaseapp.com",
    databaseURL: "https://startupsimulation-2146b.firebaseio.com",
    projectId: "startupsimulation-2146b",
    storageBucket: "startupsimulation-2146b.appspot.com",
    messagingSenderId: "822796022567"
  };
  firebase.initializeApp(config);
</script>
